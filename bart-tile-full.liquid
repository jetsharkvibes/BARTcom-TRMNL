{% assign line_map = 'San Francisco International Airport:SFIA,SF / SFO Airport / Millbrae:MLBR,OAK Airport / Berryessa:BERY,SF / OAK Airport / Berryessa:BERY,SFO / SF / Richmond:RICH,SF / OAK Airport / Dublin/Pleasanton:DUBL,OAK Airport / SF / Daly City:DALY,Antioch:ANTC,San Francisco / Pittsburg/Bay Point:PITT,OAK Airport / Berryessa/North San Jose:BERY,San Francisco Int\'l Airport/Millbrae:SFOM,SFO Airport / Millbrae:SFOM,Millbrae (Caltrain Transfer Platform):MLBR,Richmond:RICH,SF / Daly City:DALY,Warm Springs/South Fremont:WARM,San Francisco / Antioch:ANTC,Antioch:ANTC,Dublin/Pleasanton:DUBL,SFO International Airport:SFIA,San Francisco International Airport:SFIA,Oakland Airport:OAKL,OAK Airport / Dublin/Pleasanton:DUBL' | split: ',' %}
<div class="layout layout--col gap--large">
  <!-- Header: Origin → Destination -->
  <div class="header">
    <div class="title title--large">{{ root.origin }} → {{ root.destination }}</div>
  </div>

  {% if root.schedule.request.trip %}
    <div class="grid grid--cols-3 gap--medium">
      {% assign trips = root.schedule.request.trip %}
      {% for trip in trips limit:3 %}
        <div class="item" style="background-color: #000; border-radius: 12px; padding: 16px;">
          <div class="content layout--col gap--small">
            <!-- Train Line Badges -->
            <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; row-gap: 8px;">
              {% if trip.leg[0] %}
                {% assign leg_count = 0 %}
                {% for leg in trip.leg %}
                  {% assign train_line = leg['@trainHeadStation'] %}
                  {% assign to_abbr = '' %}
                  {% for pair in line_map %}
                    {% assign parts = pair | split: ':' %}
                    {% if train_line == parts[0] %}
                      {% assign to_abbr = parts[1] %}
                    {% endif %}
                  {% endfor %}
                  {% if train_line and leg_count < 2 %}
                    <div class="bg--white" style="border-radius: 6px; padding: 8px 8px;">
                      <div style="color: #000; font-weight: bold; font-size: 14px; white-space: nowrap;">
                        {{ to_abbr | default: train_line }}
                      </div>
                    </div>
                    {% assign leg_count = leg_count | plus: 1 %}
                  {% endif %}
                {% endfor %}
              {% elsif trip.leg['@trainHeadStation'] %}
                {% assign train_line = trip.leg['@trainHeadStation'] %}
                {% assign to_abbr = '' %}
                {% for pair in line_map %}
                  {% assign parts = pair | split: ':' %}
                  {% if train_line == parts[0] %}
                    {% assign to_abbr = parts[1] %}
                  {% endif %}
                {% endfor %}
                <div class="bg--white" style="border-radius: 6px; padding: 8px 8px;">
                  <div style="color: #000; font-weight: bold; font-size: 14px; white-space: nowrap;">
                    {{ to_abbr | default: train_line }}
                  </div>
                </div>
              {% endif %}
            </div>

            <div class="value value--medium" style="line-height: 1.0; white-space: nowrap; color: white;">
              {{ trip['@origTimeMin'] }}
            </div>
            <div class="label label--xsmall" style="color: white;">DEPART</div>
            <div class="divider" style="border-color: rgba(255,255,255,0.3);"></div>
            <div class="label label--xsmall" style="color: white;">ARRIVE {{ trip['@destTimeMin'] }}</div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <!-- Error State: No data -->
    <div class="item">
      <div class="content layout--col gap--small">
        <div class="value value--xlarge">⚠️</div>
        <div class="label label--small">No schedule available</div>
        {% if root.message.error %}
          <div class="label label--xsmall">{{ root.message.error.text }}</div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <div class="footer">
    <div class="divider"></div>
    <div class="label lab